---
title: "[ELK Stack-02] Logstash 활용"
category: ELK Stack
tag: Logstash
---

오늘은 **ELK Stack**에서 데이터 수집 엔진인 **Logstash**에 대해 알아보도록 하자. 

Logstash에 대한 소개 및 특정 예시를 통한 활용을 설명하도록 할께.

## Logstash란 무엇인가?

Logstash는 실시간 파이프라인 기능을 가진 오픈 소스 데이터 수집 엔진이야. Logstash의 파이프라인은 다음 그림에서 확인할 수 있어.

<a href="https://i.imgur.com/rHoB6Th"><img src="https://i.imgur.com/rHoB6Th.png" width="500px" title="source: imgur.com" /></a>

Logstash 파이프라인은 **input, filter, output** 단계로 구성되어있어. 각각은 다음의 역할을 수행해.

 ● **input** : 여러 시스템의 다양한 형태 데이터를 수집하는 역할<br/>
 ● **filter** : 구문 분석 및 필드 식별을 통해 데이터를 변환하고 정형화하는 역할<br/>
 ● **output** : 다양한 저장소에 데이터를 출력하는 역할

Logstash를 활용하면 다양한 source에서 데이터를 수집하고 동적으로 변환, 다양한 저장소로 출력할 수 있다는 장점이 있어.

이런 장점은 **플러그인** 기반으로 input/filter/output을 구성할 수 있다는 특성에서 나오게 돼.

200개가 넘는 플러그인 사용이 가능하며, 다른 input/filter/output 플러그인을 조합할 수 있지.

## Logstash 파이프라인 구성

Logstash 파이프라인 구성을 위해서는 **구성(.conf) 파일**을 만들어야해. 해당 포스트에서는 "logstash/config/test.conf"에 생성한다고 가정할께.

### Logstash 구성 파일 형태

```json
## logstash/config/test.conf

input{
  ...
  }

filter{
  ...
  }

output{
  ...
  }
```

input 단계에는 beats/elasticsearch/file/jdbc 등의 입력 플러그인, filter 단계에는 dissect/grok/mutate/split 등의 필터 플러그인, output 단계에는 stdout/csv/elasticsearrch/email 등의 출력 플러그인을 넣을 수 있어.

다양한 플러그인과 그 기능은 [Logstash reference](https://www.elastic.co/guide/en/logstash/current/index.html)에서 확인할 수 있어.


## Logstash 활용 예제

Logstash를 활용해서 예제 데이터를 수집/변환하여 Elasticsearch 서버로 적재하는 작업을 해보자. 

### 예제: 일기예보 데이터

다음의 예제 데이터가 "C:/weather_201901" 경로에 "test"라는 파일명으로 존재한다고 하자.

|20190101;서울;주간;아침 시간에는 북쪽에서 불어오는 바람에 의해 기온이 영햐일 예정입니다.\r\n 오전에 끼었던 구름이 오후가 되면서 걷힐 예정입니다.|
|20190101;서울;야간;저녁에는 맑은 날씨를 보입니다.\r\n 밝은 보름달을 볼 수 있습니다.|
|...|
|20190131;전북;주간;거센 눈발이 날릴 예정입니다.\r\n 운전 및 야외활동을 주의하세요.|

위의 일기예보 데이터의 특징은 다음과 같다고 하자.

 - test 파일은 확장자가 없는 파일이다.
 - 파일은 header를 포함하지 않는다. 단, Data;Loc;DayNight;Contents 순서로 적재된다.
 - Contents 필드에는 "\r\n" 줄바꿈 escape 문자가 포함될 수 있다.
 - 매월초에는 이전 달의 일기예보 데이터 폴더가 적재된다. 예를들어 10월 1일에는 "C:/weather_201909/test"가 생성된다.
 
위에 데이터를 수집해서 Elasticsearch 서버로 보내기 위해 "logstash/config/test.conf" 파일을 만들어보자.

### test.conf 파일
